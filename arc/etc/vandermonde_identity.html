<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vandermonde’s Identity</title>
<style>
  :root{
    --bg:#f9fafb; --card:#ffffff; --ink:#111827; --ink-dim:#4b5563;
    --muted:#6b7280; --border:#e5e7eb; --code:#f3f4f6;
    --accent:#2563eb; --accent-ink:#ffffff; --ok:#16a34a; --warn:#dc2626;
    --badge:#e2e8f0; --badge-ink:#334155;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial}
  a{color:#1d4ed8;text-decoration:none} a:hover{text-decoration:underline}
  .wrap{max-width:900px;margin:0 auto;padding:28px 16px 40px}
  header{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-bottom:16px}
  header h1{margin:0;font-size:20px;font-weight:700;letter-spacing:.2px}
  .badge{background:var(--badge);color:var(--badge-ink);border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:12px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.04);margin-top:16px}
  .card h2{margin:0 0 12px;font-size:16px;letter-spacing:.2px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .input{background:#fff;border:1px solid var(--border);border-radius:12px;padding:10px 12px;color:var(--ink);font-weight:600}
  .input:focus{outline:3px solid rgba(37,99,235,.2);border-color:#93c5fd}
  .btn{background:var(--accent);color:var(--accent-ink);border:0;padding:10px 14px;font-weight:700;border-radius:12px;cursor:pointer}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .btn.copy{background:#e5e7eb;color:#111827}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
  .dim{color:var(--muted)}
  .kpi{font-weight:800}
  .stat{
    display:grid; grid-template-columns:auto 1fr; align-items:baseline; gap:8px;
    background:#fff; padding:8px 10px; border-radius:12px; border:1px solid var(--border);
  }
  #answer{
    max-width:100%; white-space:normal; overflow-wrap:anywhere; word-break:break-word; line-break:anywhere;
    font-size:clamp(0.9rem, 1vw + 0.75rem, 1.1rem);
  }
  code,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace}
  pre{background:var(--code);border:1px solid var(--border);border-radius:12px;padding:14px;overflow:auto}
  .ok{color:var(--ok)} .bad{color:var(--warn)}
  .log{font-size:13px;max-height:240px;overflow:auto;background:var(--code);border:1px dashed var(--border);padding:10px;border-radius:12px;white-space:pre-wrap}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--border);background:#fff;color:var(--ink-dim);font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Vandermonde’s Identity</h1>
  </header>

  <!-- Mathematical English -->
  <section class="card">
    <h2>Vandermonde’s Identity</h2>
    <p class="dim">
      For nonnegative integers r, s, n, one has
      <strong>∑<sub>k=0</sub><sup>n</sup> C(r,k)·C(s,n−k) = C(r+s,n)</strong>.
      Combinatorially: to choose n items from two disjoint blocks of sizes r and s,
      pick k from the first and n−k from the second, then sum over k.
    </p>
  </section>

  <!-- A · Answer -->
  <section class="card" aria-labelledby="answer-title">
    <h2 id="answer-title">Answer</h2>
    <p class="dim">Enter nonnegative integers r, s, n (we use the closed form C(r+s, n)).</p>
    <div class="row" style="margin:10px 0 14px">
      <label class="dim" for="rInput">r:</label>
      <input id="rInput" class="input mono" type="text" value="800" inputmode="numeric" />
      <label class="dim" for="sInput">s:</label>
      <input id="sInput" class="input mono" type="text" value="900" inputmode="numeric" />
      <label class="dim" for="nInput">n:</label>
      <input id="nInput" class="input mono" type="text" value="700" inputmode="numeric" />
      <button id="runBtn" class="btn">Compute + Check</button>
      <button id="copyBtn" class="btn copy">Copy ARC JSON</button>
    </div>
    <div class="stat" role="status" aria-live="polite">
      <span class="dim">C(r+s, n) =</span>
      <span id="answer" class="kpi mono">–</span>
    </div>
  </section>

  <!-- R · Reason why -->
  <section class="card" aria-labelledby="reason-title">
    <h2 id="reason-title">Reason why (Lean 4)</h2>
    <p class="dim">
      As formalized in mathlib, Vandermonde’s identity holds because the coefficient of xⁿ in
      (1+x)ʳ(1+x)ˢ equals that in (1+x)^(r+s).
    </p>
<pre><code>-- Lean 4 (mathlib) proof of Vandermonde’s identity
import Mathlib
open Finset BigOperators

theorem vandermonde (r s n : ℕ) :
  (∑ k in Finset.range (n+1), Nat.choose r k * Nat.choose s (n - k))
  = Nat.choose (r + s) n := by
  -- mathlib provides this as `Nat.vandermonde`
  simpa using Nat.vandermonde r s n
</code></pre>
    <p class="dim">The snippet gives the formal reason; the browser doesn’t execute Lean.</p>
  </section>

  <!-- C · Check (independent harness) -->
  <section class="card" aria-labelledby="check-title">
    <h2 id="check-title">Check (independent harness)</h2>
    <p class="dim">
      We independently compute the left-hand side exactly with BigInt:
      build the tables C(r,k) and C(s,t) and sum <span class="mono">C(r,k)·C(s,n−k)</span> for k=0..n.
      PASS iff this equals the right-hand side <span class="mono">C(r+s,n)</span>.
    </p>

    <div class="row" style="margin-bottom:8px">
      <div id="statusPill" class="pill">idle</div>
      <div><span class="dim">progress:</span> <span id="progress" class="mono">0%</span></div>
    </div>
    <div class="log mono" id="log" aria-live="polite"></div>

    <h3>Result</h3>
    <p><span class="dim">Check status:</span> <strong id="checkStatus">–</strong></p>
  </section>
</div>

<script>
(function () {
  const rInput   = document.getElementById('rInput');
  const sInput   = document.getElementById('sInput');
  const nInput   = document.getElementById('nInput');
  const runBtn   = document.getElementById('runBtn');
  const copyBtn  = document.getElementById('copyBtn');
  const answerEl = document.getElementById('answer');
  const logEl    = document.getElementById('log');
  const progEl   = document.getElementById('progress');
  const pillEl   = document.getElementById('statusPill');
  const checkEl  = document.getElementById('checkStatus');

  let lastARC = null;

  function setStatus(text, kind) {
    pillEl.textContent = text;
    pillEl.style.borderColor = 'var(--border)';
    if (kind === 'ok') { pillEl.style.background = '#dcfce7'; pillEl.style.color = 'var(--ok)'; }
    else if (kind === 'bad') { pillEl.style.background = '#fee2e2'; pillEl.style.color = 'var(--warn)'; }
    else { pillEl.style.background = '#fff'; pillEl.style.color = 'var(--ink-dim)'; }
  }
  function log(line){ logEl.textContent += line + '\n'; logEl.scrollTop = logEl.scrollHeight; }
  function resetUI(){ logEl.textContent=''; progEl.textContent='0%'; checkEl.textContent='–'; checkEl.className=''; setStatus('idle'); }

  // --- parsing ---
  function parseNat(raw){
    const s = String(raw).replace(/[, _]/g, '');
    if (!/^\d+$/.test(s)) return null;
    return BigInt(s);
  }

  // --- exact binomial coefficients with BigInt ---
  function binomExact(N, K){
    if (K < 0n || K > N) return 0n;
    let k = K;
    if (k > N - k) k = N - k;
    let res = 1n;
    for (let i = 1n; i <= k; i++){
      res = (res * (N - i + 1n)) / i; // exact at each step
    }
    return res;
  }

  // prefix table: C(N,0..upto); padded with zeros beyond N
  function binomPrefix(N, upto){
    const U = Number(upto);
    const arr = new Array(U+1);
    const n = N;
    const lim = Number(n < upto ? n : upto);
    let c = 1n;
    arr[0] = 1n;
    for (let k = 0; k < lim; k++){
      c = (c * (n - BigInt(k))) / BigInt(k+1);
      arr[k+1] = c;
    }
    for (let k = lim+1; k <= U; k++) arr[k] = 0n;
    return arr;
  }

  function fmtBig(x){ const s = x.toString(); return s.replace(/\B(?=(\d{3})+(?!\d))/g, ','); }

  function arcPayload(r,s,n, ans, got, ms){
    return {
      question: `Vandermonde: sum_{k=0}^n C(r,k) C(s,n-k) = C(r+s,n) for r=${r}, s=${s}, n=${n}`,
      answer: ans.toString(),
      reason_lean4: [
        "import Mathlib",
        "open Finset BigOperators",
        "theorem vandermonde (r s n : ℕ) :",
        "  (∑ k in Finset.range (n+1), Nat.choose r k * Nat.choose s (n - k))",
        "  = Nat.choose (r + s) n := by",
        "  simpa using Nat.vandermonde r s n"
      ].join("\\n"),
      check: {
        method: "Exact BigInt convolution of binomial coefficients",
        result: got.toString(),
        pass: got === ans,
        millis: ms
      }
    };
  }

  function run(){
    resetUI();

    const r = parseNat(rInput.value);
    const s = parseNat(sInput.value);
    const n = parseNat(nInput.value);
    if (r===null || s===null || n===null){ alert('Please enter nonnegative integers r, s, n.'); return; }
    if (r < 0n || s < 0n || n < 0n){ alert('Use nonnegative integers.'); return; }

    const RS = r + s;
    const ans = binomExact(RS, n);
    answerEl.textContent = fmtBig(ans);

    // Independent Check
    setStatus('running');
    runBtn.disabled = true;
    const start = performance.now();
    log(`→ building tables C(r, k) for k=0..n and C(s, t) for t=0..n…`);

    // Precompute rows up to n (zeros beyond r or s are handled by padding)
    const N = Number(n);
    const Ar = binomPrefix(r, n); // C(r,k)
    const Cs = binomPrefix(s, n); // C(s,t)

    log(`→ summing Σ_{k=0..n} C(r,k)·C(s,n−k)…`);

    let k = 0;
    let sum = 0n;
    const CHUNK = 400; // terms per slice

    function step(){
      const end = Math.min(N, k + CHUNK);
      for (; k <= end; k++){
        sum += Ar[k] * Cs[N - k];
      }
      const pct = N === 0 ? 100 : Math.floor((k / (N+1)) * 100);
      progEl.textContent = `${pct}%`;

      if (k <= N){
        setTimeout(step, 0);
      } else {
        const ms = Math.round(performance.now() - start);
        log(`✓ finished in ${ms} ms`);
        if (sum === ans){
          setStatus('verified','ok');
          checkEl.textContent = 'PASS — convolution equals C(r+s, n)';
        } else {
          setStatus('mismatch','bad');
          checkEl.textContent = 'FAIL — mismatch between LHS and RHS';
          log(`expected: ${ans.toString()}`);
          log(`got     : ${sum.toString()}`);
        }
        lastARC = arcPayload(r.toString(), s.toString(), n.toString(), ans, sum, ms);
        runBtn.disabled = false;
      }
    }
    step();
  }

  function copyARC(){
    if (!lastARC) { alert('Run the computation first to produce ARC output.'); return; }
    const blob = new Blob([JSON.stringify(lastARC, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'arc-vandermonde.json';
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  }

  runBtn.addEventListener('click', run);
  copyBtn.addEventListener('click', copyARC);
})();
</script>
</body>
</html>

