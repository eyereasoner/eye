@prefix :     <http://example.org/roadtoreality#> .
@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix math: <http://www.w3.org/2000/10/swap/math#> .
@prefix log:  <http://www.w3.org/2000/10/swap/log#> .

############################################################
# P3: Prompt → Program → Proof (Answer, Reason, Check)
# Case: Multi-source analysis for Roger Penrose’s
#       “The Road to Reality: A Complete Guide to the Laws of the Universe”
############################################################

# -------- Vocabulary --------
:Book      a rdfs:Class .
:Source    a rdfs:Class .
:Claim     a rdfs:Class .
:Support   a rdfs:Class .
:Analysis  a rdfs:Class .
:Check     a rdfs:Class .

# Metadata & linkage
:title     a rdf:Property .
:author    a rdf:Property .
:pubYear   a rdf:Property .
:outlet    a rdf:Property .
:year      a rdf:Property .
:idx       a rdf:Property .
:url       a rdf:Property .
:about     a rdf:Property .

:book      a rdf:Property .
:from      a rdf:Property .
:kind      a rdf:Property .
:value     a rdf:Property .

:analysis  a rdf:Property .
:why       a rdf:Property .
:check     a rdf:Property .
:status    a rdf:Property .
:ok        a rdf:Property .

# Adopted facet properties (attach to the single Analysis node)
:thesis     a rdf:Property .   # comprehensive physics with mathematical foundations
:theme      a rdf:Property .   # ambitious, mathematically rigorous, challenging
:method     a rdf:Property .   # approach (builds math first; twistor/geometry emphasis)
:stance     a rdf:Property .   # critical of string theory; QM needs modification
:highlight  a rdf:Property .   # notable features (e.g., >1000 pages)
:edition    a rdf:Property .   # UK 2004 (Jonathan Cape); US 2005 (Knopf)

############################################################
# Create exactly ONE Analysis node per Book
############################################################
{
  ?B a :Book .
  ?SCOPE log:notIncludes { ?B :analysis ?A . }
}
=>
{
  _:A a :Analysis .
  ?B  :analysis _:A ;
      :status   "analysis-node-created" .
} .

############################################################
# SUPPORT: (kind,value) is supported when ≥2 distinct sources concur
############################################################
{
  ?B a :Book .
  ?C1 a :Claim; :book ?B; :kind ?K; :value ?V; :from ?S1 .
  ?C2 a :Claim; :book ?B; :kind ?K; :value ?V; :from ?S2 .
  ?S1 :idx ?i1 .
  ?S2 :idx ?i2 .
  ?i1 math:notEqualTo ?i2 .
}
=>
{
  _:sup a :Support; :book ?B; :kind ?K; :value ?V; :from ?S1, ?S2 .
} .

############################################################
# ANSWER assembly (deduplicated): attach facets to the unique node
############################################################

# Thesis
{
  ?Sp a :Support; :book ?B; :kind "thesis"; :value ?V .
  ?B  :analysis ?A .
}
=>
{
  ?A :thesis ?V .
  ?B :why ?Sp ;
     :status "analysis-built" .
} .

# Theme
{
  ?Sp a :Support; :book ?B; :kind "theme"; :value ?V .
  ?B  :analysis ?A .
}
=>
{
  ?A :theme ?V .
  ?B :why ?Sp .
} .

# Method (multiple allowed)
{
  ?Sp a :Support; :book ?B; :kind "method"; :value ?V .
  ?B  :analysis ?A .
}
=>
{
  ?A :method ?V .
  ?B :why ?Sp .
} .

# Stance
{
  ?Sp a :Support; :book ?B; :kind "stance"; :value ?V .
  ?B  :analysis ?A .
}
=>
{
  ?A :stance ?V .
  ?B :why ?Sp .
} .

# Highlight
{
  ?Sp a :Support; :book ?B; :kind "highlight"; :value ?V .
  ?B  :analysis ?A .
}
=>
{
  ?A :highlight ?V .
  ?B :why ?Sp .
} .

# Edition
{
  ?Sp a :Support; :book ?B; :kind "edition"; :value ?V .
  ?B  :analysis ?A .
}
=>
{
  ?A :edition ?V .
  ?B :why ?Sp .
} .

############################################################
# CHECKS — 8 independent verifications
############################################################

# C1: Thesis has ≥2-source support
{
  ?B :analysis ?A .
  ?A :thesis ?V .
  ?Sp a :Support; :book ?B; :kind "thesis"; :value ?V .
}
=>
{ ?B :check [ a :Check; :kind "thesis-supported-by-two"; :ok true ] . } .

# C2: Theme has ≥2-source support
{
  ?B :analysis ?A .
  ?A :theme ?V .
  ?Sp a :Support; :book ?B; :kind "theme"; :value ?V .
}
=>
{ ?B :check [ a :Check; :kind "theme-supported-by-two"; :ok true ] . } .

# C3: Each adopted method facet has ≥2-source support
{
  ?B :analysis ?A .
  ?A :method ?V .
  ?Sp a :Support; :book ?B; :kind "method"; :value ?V .
}
=>
{ ?B :check [ a :Check; :kind "method-supported-by-two"; :ok true ] . } .

# C4: Stance has ≥2-source support
{
  ?B :analysis ?A .
  ?A :stance ?V .
  ?Sp a :Support; :book ?B; :kind "stance"; :value ?V .
}
=>
{ ?B :check [ a :Check; :kind "stance-supported-by-two"; :ok true ] . } .

# C5: Highlight has ≥2-source support
{
  ?B :analysis ?A .
  ?A :highlight ?V .
  ?Sp a :Support; :book ?B; :kind "highlight"; :value ?V .
}
=>
{ ?B :check [ a :Check; :kind "highlight-supported-by-two"; :ok true ] . } .

# C6: Edition has ≥2-source support
{
  ?B :analysis ?A .
  ?A :edition ?V .
  ?Sp a :Support; :book ?B; :kind "edition"; :value ?V .
}
=>
{ ?B :check [ a :Check; :kind "edition-supported-by-two"; :ok true ] . } .

# C7: Each Support node actually references two distinct sources
{
  ?Sp a :Support; :book ?B; :from ?S1, ?S2 .
  ?S1 :idx ?i1 .
  ?S2 :idx ?i2 .
  ?i1 math:notEqualTo ?i2 .
}
=>
{ ?B :check [ a :Check; :kind "support-has-two-distinct-sources"; :ok true ] . } .

# C8: All sources about this book are on/after publication year
{
  ?B a :Book; :pubYear ?py .
  ?S a :Source; :about ?B; :year ?y .
  ?y math:notLessThan ?py .
}
=>
{ ?B :check [ a :Check; :kind "post-publication-sources"; :ok true ] . } .

############################################################
# ----------------------- HARNESS -------------------------
# Book node + real sources + claims (≥2 per adopted facet)
############################################################

# The book
:B1 a :Book;
    :title  "The Road to Reality: A Complete Guide to the Laws of the Universe";
    :author "Roger Penrose";
    :pubYear 2004 .

# Sources (distinct idx; all explicitly :about :B1)

# S1 — Penguin Random House (US/Vintage) page (scope; math foundations)
:S1 a :Source; :about :B1;
    :outlet "Penguin Random House"; :year 2007; :idx 1;
    :title "The Road to Reality — PRH page";
    :url "https://www.penguinrandomhouse.com/books/129420/the-road-to-reality-by-roger-penrose/" .

# S2 — Penguin UK (Vintage) page (comprehensive account; math background first)
:S2 a :Source; :about :B1;
    :outlet "Penguin UK (Vintage)"; :year 2006; :idx 2;
    :title "The Road to Reality — Penguin UK page";
    :url "https://www.penguin.co.uk/books/357292/the-road-to-reality-by-penrose-roger/9780099440680" .

# S3 — The Guardian feature (scope across calculus, QM, relativity, string theory; difficulty)
:S3 a :Source; :about :B1;
    :outlet "The Guardian"; :year 2004; :idx 3;
    :title "I can explain everything";
    :url "https://www.theguardian.com/books/2004/aug/15/scienceandnature.features" .

# S4 — The Guardian review (ambition; challenging for general readers)
:S4 a :Source; :about :B1;
    :outlet "The Guardian"; :year 2006; :idx 4;
    :title "Mind your p's and q's";
    :url "https://www.theguardian.com/books/2006/feb/11/featuresreviews.guardianreview22" .

# S5 — Physics Today review by Lee Smolin (stance on string theory; QM modification)
:S5 a :Source; :about :B1;
    :outlet "Physics Today"; :year 2006; :idx 5;
    :title "The Road to Reality — review by Lee Smolin";
    :url "https://physicstoday.aip.org/reviews/the-road-to-reality-a-complete-guide-to-the-laws-of-the-universe" .

# S6 — WIRED article (twistors; critique of string theory; gravity-induced collapse discussion)
:S6 a :Source; :about :B1;
    :outlet "WIRED"; :year 2005; :idx 6;
    :title "Penrose: The Answer's Not 42";
    :url "https://www.wired.com/2005/03/penrose-the-answers-not-42" .

# S7 — Amazon US (Knopf hardcover, page count; US pub date 2005)
:S7 a :Source; :about :B1;
    :outlet "Knopf (via Amazon US)"; :year 2005; :idx 7;
    :title "The Road to Reality — Knopf hardcover listing";
    :url "https://www.amazon.com/Road-Reality-Complete-Guide-Universe/dp/0679454438" .

# S8 — Wikipedia entry (editions; page count; overview)
:S8 a :Source; :about :B1;
    :outlet "Wikipedia"; :year 2024; :idx 8;
    :title "The Road to Reality — Wikipedia";
    :url "https://en.wikipedia.org/wiki/The_Road_to_Reality" .

# ---------------- Claims (kind, value) ----------------

# Thesis: comprehensive physics with mathematical foundations
:Ct1 a :Claim; :book :B1; :kind "thesis"; :value "comprehensive-physics-with-math-foundations"; :from :S1 .
:Ct2 a :Claim; :book :B1; :kind "thesis"; :value "comprehensive-physics-with-math-foundations"; :from :S2 .

# Theme: ambitious, mathematically rigorous, challenging for general readers
:Cth1 a :Claim; :book :B1; :kind "theme"; :value "ambitious-math-heavy-and-challenging"; :from :S3 .
:Cth2 a :Claim; :book :B1; :kind "theme"; :value "ambitious-math-heavy-and-challenging"; :from :S4 .

# Method A: builds mathematical background first, then physics
:Cm1 a :Claim; :book :B1; :kind "method"; :value "builds-math-then-physics"; :from :S1 .
:Cm2 a :Claim; :book :B1; :kind "method"; :value "builds-math-then-physics"; :from :S2 .

# Method B: twistor/geometry emphasis among approaches
:Cm3 a :Claim; :book :B1; :kind "method"; :value "twistor-and-geometric-emphasis"; :from :S6 .
:Cm4 a :Claim; :book :B1; :kind "method"; :value "twistor-and-geometric-emphasis"; :from :S5 .

# Stance: critical of string theory; argues QM needs modification for gravity
:Cs1 a :Claim; :book :B1; :kind "stance"; :value "critical-of-string-theory-and-QM-modification"; :from :S5 .
:Cs2 a :Claim; :book :B1; :kind "stance"; :value "critical-of-string-theory-and-QM-modification"; :from :S6 .

# Highlight: very long book (>1000 pages)
:Ch1 a :Claim; :book :B1; :kind "highlight"; :value "over-1000-pages"; :from :S7 .
:Ch2 a :Claim; :book :B1; :kind "highlight"; :value "over-1000-pages"; :from :S8 .

# Edition: UK 2004 (Jonathan Cape); US 2005 (Knopf)
:Ce1 a :Claim; :book :B1; :kind "edition"; :value "UK-2004-Jonathan-Cape_US-2005-Knopf"; :from :S8 .
:Ce2 a :Claim; :book :B1; :kind "edition"; :value "UK-2004-Jonathan-Cape_US-2005-Knopf"; :from :S7 .

