@prefix ex:   <http://example.org/> .
@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix math: <http://www.w3.org/2000/10/swap/math#> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .

# @name: R1_FuelIndexForAnyRoute
{
  ex:scan1 ex:forShipment ?S .
  ?S       ex:payloadKg ?Wkg .
  ( ?Wkg 1000 ) math:quotient ?Wton .

  ?R  rdf:type ex:Route .
  ?R  ex:distanceKm ?Dkm .
  ?R  ex:gradientFactor ?Gf .

  ( ?Dkm ?Wton ) math:product ?Work .
  ( ?Work ?Gf )  math:product ?FuelIndex .
}
=>
{
  ?R ex:fuelIndex ?FuelIndex .
} .

# @name: R2_BannerIfOverThreshold (self-contained)
{
  ex:scan1 ex:forShipment ?S .
  ?S       ex:payloadKg ?Wkg .
  ( ?Wkg 1000 ) math:quotient ?Wton .

  ex:scan1 ex:usesRoute ?R1 .
  ?R1 ex:distanceKm ?D1 .
  ?R1 ex:gradientFactor ?G1 .
  ( ?D1 ?Wton ) math:product ?W1 .
  ( ?W1 ?G1 )   math:product ?Fi1 .

  ex:policy ex:fuelIndexThreshold ?T .
  ?Fi1 math:greaterThan ?T .

  ex:scan1 ex:inDepot ?Depot .
}
=>
{
  ex:insight1 rdf:type ex:Insight .
  ex:insight1 ex:showEcoBanner ?Depot .
  ex:insight1 ex:fuelIndex ?Fi1 .
} .

# @name: R3_SuggestAlternativeIfBetter (self-contained)
{
  ex:scan1 ex:forShipment ?S .
  ?S       ex:payloadKg ?Wkg .
  ( ?Wkg 1000 ) math:quotient ?Wton .

  ex:scan1 ex:usesRoute ?R1 .
  ?R1 ex:distanceKm ?D1 .
  ?R1 ex:gradientFactor ?G1 .
  ( ?D1 ?Wton ) math:product ?W1 .
  ( ?W1 ?G1 )   math:product ?Fi1 .

  ex:altRoute ex:distanceKm ?D2 .
  ex:altRoute ex:gradientFactor ?G2 .
  ( ?D2 ?Wton ) math:product ?W2 .
  ( ?W2 ?G2 )   math:product ?Fi2 .

  ?Fi1 math:greaterThan ?Fi2 .
}
=>
{
  ex:insight1 ex:suggestRoute ex:altRoute .
} .

# @name: R4_ComputeSavingsAndGuardAlt (self-contained)
{
  ex:scan1 ex:forShipment ?S .
  ?S       ex:payloadKg ?Wkg .
  ( ?Wkg 1000 ) math:quotient ?Wton .

  ex:scan1 ex:usesRoute ?R1 .
  ?R1 ex:distanceKm ?D1 .
  ?R1 ex:gradientFactor ?G1 .
  ( ?D1 ?Wton ) math:product ?W1 .
  ( ?W1 ?G1 )   math:product ?Fi1 .

  ex:altRoute ex:distanceKm ?D2 .
  ex:altRoute ex:gradientFactor ?G2 .
  ( ?D2 ?Wton ) math:product ?W2 .
  ( ?W2 ?G2 )   math:product ?Fi2 .

  ( ?Fi1 ?Fi2 ) math:difference ?Saving .
  ex:policy ex:fuelIndexThreshold ?T .
  ?Fi2 math:notGreaterThan ?T .
}
=>
{
  ex:insight1 ex:estimatedSaving ?Saving .
} .

# @name: R5_OptionalComfortIndex (sum, notLessThan)
{
  ?R ex:distanceKm ?D .
  ?R ex:gradientFactor ?Gf .
  ( ?Gf 10 ) math:product ?Pg .
  ( ?D ?Pg ) math:sum ?Comfort .
  ?Comfort math:notLessThan 40 .
}
=>
{
  ?R ex:comfortIndex ?Comfort .
} .
