@prefix :     <http://example.org/secretlivesofnumbers#> .
@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix math: <http://www.w3.org/2000/10/swap/math#> .
@prefix log:  <http://www.w3.org/2000/10/swap/log#> .

############################################################
# P3: Prompt → Program → Proof (Answer, Reason, Check)
# Case: Multi-source analysis for
#       "The Secret Lives of Numbers"
#       (Kate Kitagawa & Timothy Revell)
############################################################

# -------- Vocabulary --------
:Book      a rdfs:Class .
:Source    a rdfs:Class .
:Claim     a rdfs:Class .
:Support   a rdfs:Class .
:Analysis  a rdfs:Class .
:Check     a rdfs:Class .

# Metadata & linkage (declare properties explicitly)
:title     a rdf:Property .
:author    a rdf:Property .
:pubYear   a rdf:Property .
:outlet    a rdf:Property .
:year      a rdf:Property .
:idx       a rdf:Property .
:url       a rdf:Property .
:about     a rdf:Property .

:book      a rdf:Property .
:from      a rdf:Property .
:kind      a rdf:Property .
:value     a rdf:Property .

:analysis  a rdf:Property .
:why       a rdf:Property .
:check     a rdf:Property .
:status    a rdf:Property .
:ok        a rdf:Property .

# Adopted facet properties (attach to the single Analysis node)
:thesis       a rdf:Property .   # global history & unsung trailblazers
:stance       a rdf:Property .   # challenges Eurocentric/one-sided narrative
:theme        a rdf:Property .   # accessible, engaging narrative history
:highlight    a rdf:Property .   # concrete examples of overlooked figures
:recognition  a rdf:Property .   # major shortlist/awards

############################################################
# Create exactly ONE Analysis node per Book
############################################################
{
  ?B a :Book .
  ?SCOPE log:notIncludes { ?B :analysis ?A . }
}
=>
{
  _:A a :Analysis .
  ?B  :analysis _:A ;
      :status   "analysis-node-created" .
} .

############################################################
# SUPPORT: (kind,value) is supported when ≥2 distinct sources concur
############################################################
{
  ?B a :Book .
  ?C1 a :Claim; :book ?B; :kind ?K; :value ?V; :from ?S1 .
  ?C2 a :Claim; :book ?B; :kind ?K; :value ?V; :from ?S2 .
  ?S1 :idx ?i1 .
  ?S2 :idx ?i2 .
  ?i1 math:notEqualTo ?i2 .
}
=>
{
  _:sup a :Support; :book ?B; :kind ?K; :value ?V; :from ?S1, ?S2 .
} .

############################################################
# ANSWER assembly (deduplicated): attach facets to the unique node
############################################################

# Thesis
{
  ?Sp a :Support; :book ?B; :kind "thesis"; :value ?V .
  ?B  :analysis ?A .
}
=>
{
  ?A :thesis ?V .
  ?B :why ?Sp ;
     :status "analysis-built" .
} .

# Stance
{
  ?Sp a :Support; :book ?B; :kind "stance"; :value ?V .
  ?B  :analysis ?A .
}
=>
{
  ?A :stance ?V .
  ?B :why ?Sp .
} .

# Theme
{
  ?Sp a :Support; :book ?B; :kind "theme"; :value ?V .
  ?B  :analysis ?A .
}
=>
{
  ?A :theme ?V .
  ?B :why ?Sp .
} .

# Highlight
{
  ?Sp a :Support; :book ?B; :kind "highlight"; :value ?V .
  ?B  :analysis ?A .
}
=>
{
  ?A :highlight ?V .
  ?B :why ?Sp .
} .

# Recognition
{
  ?Sp a :Support; :book ?B; :kind "recognition"; :value ?V .
  ?B  :analysis ?A .
}
=>
{
  ?A :recognition ?V .
  ?B :why ?Sp .
} .

############################################################
# CHECKS — 8 independent verifications
############################################################

# C1: Thesis has ≥2-source support
{
  ?B :analysis ?A .
  ?A :thesis ?V .
  ?Sp a :Support; :book ?B; :kind "thesis"; :value ?V .
}
=>
{ ?B :check [ a :Check; :kind "thesis-supported-by-two"; :ok true ] . } .

# C2: Stance has ≥2-source support
{
  ?B :analysis ?A .
  ?A :stance ?V .
  ?Sp a :Support; :book ?B; :kind "stance"; :value ?V .
}
=>
{ ?B :check [ a :Check; :kind "stance-supported-by-two"; :ok true ] . } .

# C3: Theme has ≥2-source support
{
  ?B :analysis ?A .
  ?A :theme ?V .
  ?Sp a :Support; :book ?B; :kind "theme"; :value ?V .
}
=>
{ ?B :check [ a :Check; :kind "theme-supported-by-two"; :ok true ] . } .

# C4: Highlight has ≥2-source support
{
  ?B :analysis ?A .
  ?A :highlight ?V .
  ?Sp a :Support; :book ?B; :kind "highlight"; :value ?V .
}
=>
{ ?B :check [ a :Check; :kind "highlight-supported-by-two"; :ok true ] . } .

# C5: Recognition has ≥2-source support
{
  ?B :analysis ?A .
  ?A :recognition ?V .
  ?Sp a :Support; :book ?B; :kind "recognition"; :value ?V .
}
=>
{ ?B :check [ a :Check; :kind "recognition-supported-by-two"; :ok true ] . } .

# C6: Each Support node really references two distinct sources
{
  ?Sp a :Support; :book ?B; :from ?S1, ?S2 .
  ?S1 :idx ?i1 .
  ?S2 :idx ?i2 .
  ?i1 math:notEqualTo ?i2 .
}
=>
{ ?B :check [ a :Check; :kind "support-has-two-distinct-sources"; :ok true ] . } .

# C7: All sources about this book are on/after publication year
{
  ?B a :Book; :pubYear ?py .
  ?S a :Source; :about ?B; :year ?y .
  ?y math:notLessThan ?py .
}
=>
{ ?B :check [ a :Check; :kind "post-publication-sources"; :ok true ] . } .

# C8: Status flag present (analysis node created or built)
{
  ?B :status ?st .
}
=>
{ ?B :check [ a :Check; :kind "has-status-flag"; :ok true ] . } .

############################################################
# ----------------------- HARNESS -------------------------
# Book node + real sources + claims (≥2 per adopted facet)
############################################################

# The book (use earliest wide release year so later sources pass C7)
:B1 a :Book;
    :title  "The Secret Lives of Numbers";
    :author "Kate Kitagawa; Timothy Revell";
    :pubYear 2023 .

# Sources (distinct idx; all explicitly :about :B1)

# S1 — The Guardian feature (global/overlooked focus; challenges the usual story)
:S1 a :Source; :about :B1;
    :outlet "The Guardian"; :year 2024; :idx 1;
    :title "Hidden figures: giving history’s most overlooked mathematicians their due";
    :url "https://www.theguardian.com/books/article/2024/jul/29/secret-lives-numbers-history-mathematicians-overlooked" .

# S2 — Penguin (Viking) book page (publisher summary)
:S2 a :Source; :about :B1;
    :outlet "Penguin (Viking)"; :year 2024; :idx 2;
    :title "The Secret Lives of Numbers — book page";
    :url "https://www.penguin.co.uk/books/446616/the-secret-lives-of-numbers-by-revell-kate-kitagawa-and-timothy/9780241994351" .

# S3 — British Academy Book Prize (book page; 2024 shortlist context)
:S3 a :Source; :about :B1;
    :outlet "British Academy"; :year 2024; :idx 3;
    :title "The Secret Lives of Numbers — BA Book Prize page";
    :url "https://www.thebritishacademy.ac.uk/british-academy-book-prize/2024/the-secret-lives-of-numbers/" .

# S4 — British Academy news (shortlist announcement)
:S4 a :Source; :about :B1;
    :outlet "British Academy"; :year 2024; :idx 4;
    :title "British Academy Book Prize 2024 shortlist announced";
    :url "https://www.thebritishacademy.ac.uk/news/british-academy-book-prize-2024-shortlist-announced/" .

# S5 — New York Times review mention (accessed via MuckRack; accessibility angle)
:S5 a :Source; :about :B1;
    :outlet "The New York Times (via MuckRack)"; :year 2024; :idx 5;
    :title "The Fascinating Story of Math in a Book You Can Actually Understand";
    :url "https://muckrack.com/alec-wilkinson/articles" .

# S6 — Library newsletter / Recent releases (accessibility & overview)
:S6 a :Source; :about :B1;
    :outlet "LibraryAware Newsletter"; :year 2024; :idx 6;
    :title "Nature & Science — Recent Releases (Aug 2024)";
    :url "https://libraryaware.com/1112/NewsletterIssues/ViewIssue/afbc486e-f434-4977-9c7d-9aebb5547c34?postId=39a01351-e1e8-4be1-a880-e8aecdc97650" .

# S7 — Author site / metadata (UK 2023; NA 2024)
:S7 a :Source; :about :B1;
    :outlet "Author site"; :year 2023; :idx 7;
    :title "The Secret Lives of Numbers — author page";
    :url "https://www.tomokokitagawa.com/" .

# ---------------- Claims (kind, value) ----------------

# Thesis: a global history foregrounding unsung trailblazers
:Ct1 a :Claim; :book :B1; :kind "thesis"; :value "global-history-unsung-trailblazers"; :from :S2 .
:Ct2 a :Claim; :book :B1; :kind "thesis"; :value "global-history-unsung-trailblazers"; :from :S3 .

# Stance: challenges the traditional Eurocentric / one-sided narrative
:Cs1 a :Claim; :book :B1; :kind "stance"; :value "challenges-eurocentric-narrative"; :from :S1 .
:Cs2 a :Claim; :book :B1; :kind "stance"; :value "challenges-eurocentric-narrative"; :from :S2 .

# Theme: accessible, engaging narrative history of mathematics
:Cth1 a :Claim; :book :B1; :kind "theme"; :value "accessible-engaging-narrative"; :from :S5 .
:Cth2 a :Claim; :book :B1; :kind "theme"; :value "accessible-engaging-narrative"; :from :S6 .

# Highlight: vivid examples of overlooked figures across cultures
:Ch1 a :Claim; :book :B1; :kind "highlight"; :value "overlooked-figures-across-cultures"; :from :S1 .
:Ch2 a :Claim; :book :B1; :kind "highlight"; :value "overlooked-figures-across-cultures"; :from :S3 .

# Recognition: shortlisted for the 2024 British Academy Book Prize
:Cr1 a :Claim; :book :B1; :kind "recognition"; :value "BA-Book-Prize-2024-shortlist"; :from :S3 .
:Cr2 a :Claim; :book :B1; :kind "recognition"; :value "BA-Book-Prize-2024-shortlist"; :from :S4 .

